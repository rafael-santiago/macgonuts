/*
 * Copyright (c) 2023, Rafael Santiago
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree.
 */
#include "macgonuts_routeconv_tests.h"
#include <macgonuts_routeconv.h>

CUTE_TEST_CASE(macgonuts_is_outward_dest_tests)
    struct test_ctx {
        const uint8_t dest_addr[16];
        const uint8_t net_mask[16];
        const uint8_t lo_addr[16];
        const size_t proto_addr_size;
        const int expected;
    } test_vector[] = {
        {
            { 0x7F, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            { 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            { 0x7F, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            4,
            0
        },
        {
            { 0x08, 0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            { 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            { 0xC0, 0x1E, 0x46, 0xFF, 0x00, 0x00, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            4,
            1
        },
        {
            { 0xDE, 0xAD, 0xBE, 0xEF, 0xBE, 0xEF, 0xDE, 0xAD,
              0x00, 0x01, 0x02, 0x03, 0x04, 0x55, 0x09, 0x12 },
            { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            { 0xDE, 0xAD, 0xBE, 0xEF, 0xBE, 0xEF, 0xDE, 0xAD,
              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF },
            16,
            0
        },
        {
            { 0x20, 0x01, 0x48, 0x60, 0x48, 0x60, 0x00, 0x00,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x88 },
            { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
            { 0x20, 0x01, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF },
            16,
            1
        },
    }, *test = &test_vector[0], *test_end = test + sizeof(test_vector) / sizeof(test_vector[0]);
    while (test != test_end) {
        CUTE_ASSERT(macgonuts_is_outward_dest(test->dest_addr,
                                              test->net_mask,
                                              test->lo_addr,
                                              test->proto_addr_size) == test->expected);
        test++;
    }
CUTE_TEST_CASE_END
